{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="modal" id="profileModal" style="display: block; position: relative; background: transparent; box-shadow: none;">
    <div class="modal-content" style="margin: 30px auto;">
        <div class="modal-header">
            <h2 class="modal-title">My Profile</h2>
        </div>
        
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
        
        <!-- Avatar Upload Form -->
        <div class="form-group text-center">
            <div class="user-avatar-large" id="userAvatarLarge" 
                 style="width: 120px; height: 120px; margin: 0 auto 20px; 
                        {% if user.avatar %}background-image: url('{{ user.avatar.url }}');{% endif %}
                        background-size: cover; background-position: center;
                        border-radius: 50%; background-color: var(--primary); color: white; 
                        display: flex; align-items: center; justify-content: center; 
                        font-size: 3rem; cursor: pointer; border: 4px solid var(--primary);">
                {% if not user.avatar %}{{ user.first_name|first|upper }}{{ user.last_name|first|upper }}{% endif %}
            </div>
            <form method="post" action="{% url 'profile' %}" enctype="multipart/form-data" id="avatarForm">
                {% csrf_token %}
                <input type="file" id="profilePhotoInput" name="avatar" accept="image/*" style="display: none;" onchange="this.form.submit()">
                <button type="button" class="btn-pink" onclick="document.getElementById('profilePhotoInput').click()">
                    <i class="fas fa-upload"></i> Upload New Photo
                </button>
            </form>
        </div>
        
        <!-- Profile Update Form -->
        <form method="post" action="{% url 'update_profile' %}" enctype="multipart/form-data" id="profileForm">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="id_first_name">First Name</label>
                <input type="text" id="id_first_name" name="first_name" class="form-control" value="{{ user.first_name }}" required>
            </div>
            
            <div class="form-group">
                <label for="id_last_name">Last Name</label>
                <input type="text" id="id_last_name" name="last_name" class="form-control" value="{{ user.last_name }}" required>
            </div>
            
            <div class="form-group">
                <label for="id_email">Email Address</label>
                <input type="email" id="id_email" class="form-control" value="{{ user.email }}" readonly>
                <small class="form-text text-muted">Email cannot be changed</small>
            </div>
            
            <div class="form-group">
                <label for="id_phone">Phone Number</label>
                <input type="tel" id="id_phone" name="phone" class="form-control" value="{{ user.phone }}" required>
            </div>
            
            <div class="form-group">
                <label for="id_current_password">Current Password (required for changes)</label>
                <input type="password" id="id_current_password" name="current_password" class="form-control">
                <small class="form-text text-muted">Enter your current password to save any changes</small>
            </div>
            
            <div class="form-group">
                <label for="id_new_password">New Password (optional)</label>
                <input type="password" id="id_new_password" name="new_password" class="form-control">
                <small class="form-text text-muted">Leave blank to keep current password</small>
            </div>
            
            <div class="form-group">
                <label for="id_confirm_new_password">Confirm New Password</label>
                <input type="password" id="id_confirm_new_password" name="confirm_new_password" class="form-control">
            </div>
            
            <button type="submit" class="btn btn-success" style="width: 100%;">
                <i class="fas fa-save"></i> Update Profile
            </button>
        </form>
        
        <div style="text-align: center; margin-top: 20px;">
            <a href="{% url 'home' %}" class="btn btn-outline">Back to Home</a>
        </div>
    </div>
</div>

<style>
    .form-control {
        width: 100%;
        padding: 12px;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        font-size: 1rem;
        margin-bottom: 15px;
        transition: all 0.3s ease;
    }
    
    .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.1);
    }
    
    .btn-pink {
        background-color: #e91e63;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        margin-bottom: 20px;
        transition: all 0.3s ease;
    }
    
    .btn-pink:hover {
        background-color: #c2185b;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(233, 30, 99, 0.3);
    }
    
    .form-text {
        font-size: 0.8rem;
        color: #6c757d;
        margin-top: 5px;
    }
    
    .alert {
        padding: 12px 15px;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    
    .alert-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
</style>
{% endblock %}